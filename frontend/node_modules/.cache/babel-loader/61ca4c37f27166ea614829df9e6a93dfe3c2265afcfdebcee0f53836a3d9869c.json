{"ast":null,"code":"import{API_URL,isApiRequest}from\"./api\";export function installAuthFetchInterceptor(onExpired){if(typeof window===\"undefined\")return;const w=window;if(w.__authFetchInstalled)return;const originalFetch=window.fetch.bind(window);window.fetch=async(input,init)=>{try{const url=typeof input===\"string\"?input:input.url||String(input);let targetStr=url;let isApiCall=isApiRequest(url);// Rewrite relative '/api' to configured API_URL\nif(typeof url===\"string\"&&url.startsWith(\"/api\")){targetStr=`${API_URL}${url}`;isApiCall=true;}// Rewrite absolute localhost:4000 to configured API_URL (preserve path/query)\nif(typeof url===\"string\"&&/^https?:\\/\\/localhost:4000\\//i.test(url)){try{const u=new URL(url);const base=new URL(API_URL);targetStr=`${base.origin}${u.pathname}${u.search}`;isApiCall=true;}catch{}}const headers=new Headers((init===null||init===void 0?void 0:init.headers)||{});let attachedAuth=false;if(isApiCall){const jwt=localStorage.getItem(\"token\");if(jwt&&!headers.has(\"Authorization\")){headers.set(\"Authorization\",`Bearer ${jwt}`);attachedAuth=true;}else if(headers.has(\"Authorization\")){attachedAuth=true;}}const target=typeof input===\"string\"?targetStr:targetStr;const resp=await originalFetch(target,{...init,headers});if(isApiCall&&attachedAuth&&(resp.status===401||resp.status===403)){try{onExpired===null||onExpired===void 0?void 0:onExpired();}catch{}}return resp;}catch(e){// In case of wrapping error, fallback to original fetch\nreturn originalFetch(input,init);}};w.__authFetchInstalled=true;}","map":{"version":3,"names":["API_URL","isApiRequest","installAuthFetchInterceptor","onExpired","window","w","__authFetchInstalled","originalFetch","fetch","bind","input","init","url","String","targetStr","isApiCall","startsWith","test","u","URL","base","origin","pathname","search","headers","Headers","attachedAuth","jwt","localStorage","getItem","has","set","target","resp","status","e"],"sources":["/Users/yavuz/Desktop/portfolio/erasmus-exam-page/frontend/src/utils/installAuthFetchInterceptor.ts"],"sourcesContent":["import { API_URL, isApiRequest } from \"./api\";\n\nexport function installAuthFetchInterceptor(onExpired: () => void) {\n  if (typeof window === \"undefined\") return;\n  const w = window as any;\n  if (w.__authFetchInstalled) return;\n  const originalFetch = window.fetch.bind(window);\n  window.fetch = async (input: RequestInfo | URL, init?: RequestInit) => {\n    try {\n      const url =\n        typeof input === \"string\" ? input : (input as any).url || String(input);\n      let targetStr = url;\n      let isApiCall = isApiRequest(url);\n      // Rewrite relative '/api' to configured API_URL\n      if (typeof url === \"string\" && url.startsWith(\"/api\")) {\n        targetStr = `${API_URL}${url}`;\n        isApiCall = true;\n      }\n      // Rewrite absolute localhost:4000 to configured API_URL (preserve path/query)\n      if (\n        typeof url === \"string\" &&\n        /^https?:\\/\\/localhost:4000\\//i.test(url)\n      ) {\n        try {\n          const u = new URL(url);\n          const base = new URL(API_URL);\n          targetStr = `${base.origin}${u.pathname}${u.search}`;\n          isApiCall = true;\n        } catch {}\n      }\n      const headers = new Headers(init?.headers || {});\n      let attachedAuth = false;\n      if (isApiCall) {\n        const jwt = localStorage.getItem(\"token\");\n        if (jwt && !headers.has(\"Authorization\")) {\n          headers.set(\"Authorization\", `Bearer ${jwt}`);\n          attachedAuth = true;\n        } else if (headers.has(\"Authorization\")) {\n          attachedAuth = true;\n        }\n      }\n      const target: RequestInfo | URL =\n        typeof input === \"string\" ? targetStr : targetStr;\n      const resp = await originalFetch(target, { ...init, headers });\n      if (\n        isApiCall &&\n        attachedAuth &&\n        (resp.status === 401 || resp.status === 403)\n      ) {\n        try {\n          onExpired?.();\n        } catch {}\n      }\n      return resp;\n    } catch (e) {\n      // In case of wrapping error, fallback to original fetch\n      return originalFetch(input, init);\n    }\n  };\n  w.__authFetchInstalled = true;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}